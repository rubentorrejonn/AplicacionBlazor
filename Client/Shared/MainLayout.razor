@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@inject IJSRuntime JSRuntime

<CascadingAuthenticationState>
    <div class="page">
        <!--
        <div class="sidebar">
            <NavMenu />
        </div>
        -->

        <main>
            <nav class="main-nav d-flex justify-content-between align-items-center px-4 py-2 bg-secondary bg-opacity-25 shadow-sm">
                <div class="d-flex align-items-center">
                    <div class="nav-item px-3">
                        <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                            <span class="oi oi-home" aria-hidden="true"></span> Home
                        </NavLink>
                    </div>
                    <AuthorizeView Policy="Cliente">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="refpage">
                                <span class="oi oi-tag" aria-hidden="true"></span> Referencias
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="recepciones">
                                <span class="oi oi-list-rich" aria-hidden="true"></span> Recepciones Cabecera
                            </NavLink>
                        </div>
                    </AuthorizeView>
                    <AuthorizeView Policy="ICP">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="icp">
                                <span class="oi oi-list" aria-hidden="true"></span> Recepciones ICP
                            </NavLink>
                        </div>
                    </AuthorizeView>
                    <AuthorizeView Policy="ICP">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="moverpalets">
                                <span class="oi oi-move" aria-hidden="true"></span> Mover Palets
                            </NavLink>
                        </div>
                    </AuthorizeView>
                    <AuthorizeView Policy="ICP">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="icp/picking">
                                <span class="oi oi-tablet" aria-hidden="true"></span> Picking
                            </NavLink>
                        </div>
                    </AuthorizeView>
                    <AuthorizeView Policy="Cliente">
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="salidacab">
                                <span class="oi oi-cart"></span> Cabeceras Pedido
                            </NavLink>
                        </div>
                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="log">
                                <span class="oi oi-monitor"></span> Visor
                            </NavLink>
                        </div>
                    </AuthorizeView>
                </div>

                <!-- Sección de Usuario (Derecha) -->
                <div class="d-flex align-items-center">
                    <AuthorizeView>
                        <Authorized>
                            <!-- Estilo de botón redondeado y verde para el usuario logueado -->
                            <span class="badge bg bg-success bg-opacity-25 text-success rounded-pill px-3 py-2 me-3">
                                @context.User.Identity.Name
                            </span>
                            <button class="btn btn-outline-danger" @onclick="Logout">Salir</button>
                        </Authorized>

                        <!--

                        <NotAuthorized>
                            <a href="/login" class="btn btn-primary">Entrar</a>
                        </NotAuthorized>
                        -->
                    </AuthorizeView>
                </div>
            </nav>

            <article class="content px-4">
                @Body
            </article>
        </main>
    </div>
</CascadingAuthenticationState>

@code {
    [Inject] public HttpClient Http { get; set; } = default!;
    [Inject] public NavigationManager Nav { get; set; } = default!;

    private async Task Logout()
    {
        await Http.PostAsync("api/auth/logout", null);
        await JSRuntime.InvokeVoidAsync("eval", "window.location.href = '/'");
    }

    private async Task ReloadPage()
    {
        await JSRuntime.InvokeVoidAsync("location.reload");
    }
}
